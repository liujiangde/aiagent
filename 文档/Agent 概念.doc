Agent 概念（结构化版）

Ⅰ. 基础概念
- AI Agent：可调用工具、具记忆与状态、能规划与执行的智能体。
- ReAct：推理→行动→观察的回合式策略，工具结果回写上下文后继续推理。
- 函数调用（Tool Use）：以 JSON Schema 定义工具参数合同，模型产出工具与参数，宿主执行。
- Planner-Executor：Planner 生成计划，Executor 执行步骤并反馈，必要时重规划。
- 记忆与上下文：短期对话摘要、长期向量记忆；通过检索回填关键信息。

Ⅱ. 设计模式
- ReAct 提示结构：要求“思考/行动/参数/观察/最终答案”，便于解析与监督。
- 工具协议设计：JSON Schema 明确类型与必填项；严格校验与错误分级（用户/系统/外部）。
- Planner-Executor 工作流：持久化轨迹与状态机；失败回滚/重试；引入 Reviewer 纠错。
- 路由与协作：多代理按角色分工（研究/执行/审阅），按任务特征路由到不同策略。
- 退出条件：最大步数、无新信息、连续失败、达到目标置信度。

Ⅲ. 最佳实践
- 输出合同：优先 JSON/Markdown 固定结构，失败时重试并解析校验。
- 参数与安全：最小权限、幂等、速率限制、路径白名单；对外部请求设重试与熔断。
- 观测与日志：记录请求/响应/工具调用/成本；可视化轨迹便于调试与评估。
- 评估与回归：建立用例与断言（任务成功率、RAG 相关性、工具正确率）。
- 成本与性能：上下文摘要与裁剪，检索代替长提示，缓存热数据。

Ⅳ. 常见坑
- 输出漂移：未固定格式或示例不足；应设严格合同与校验。
- 工具死循环：缺少退出条件与状态机；应限制步数并检测重复信息。
- 上下文过长：盲目拼接历史；应摘要关键状态并用检索。
- 权限越权：工具未隔离；应设白名单与速率限制。
- 无评估与观测：上线不可控；应先打通日志与最小评估集。

Ⅴ. 快速任务清单
- 写一个 ReAct 提示并跑 3 步循环，观察“思考/行动/观察”。
- 设计 1 个工具（搜索/时间），用 JSON Schema 定义并严格校验。
- 为循环加入退出条件（最大步数=5、无新信息、连续失败）。
- 记录轨迹日志与成本（请求、工具调用、耗时）。
- 做 5 条用例的离线评估（成功率、可解析率），记录改进结论。

附：示例
提示（ReAct）
System: 你是可调用工具的智能体，按“思考/行动/参数/观察/最终答案”结构输出。
User: 目标与约束… 可用工具清单…

函数调用 Schema
{
  "name": "search_web",
  "description": "搜索关键词并返回摘要",
  "parameters": {
    "type": "object",
    "properties": {
      "query": { "type": "string" },
      "limit": { "type": "integer", "minimum": 1, "maximum": 5 }
    },
    "required": ["query"]
  }
}

最小执行循环（伪代码）
for step in range(MAX_STEPS):
  res = model(messages, tools)
  if res.tool_call:
    out = safe_invoke(res.tool_call)
    messages.append({ role: "tool", content: out })
  else:
    return res.content
return fallback_answer